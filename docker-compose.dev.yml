# Claudia Development Environment
# All-in-One Multi-Service Container

services:
  claudia-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: claudia-dev-env
    image: claudia-dev:latest
    ports:
      - "8080:8080"   # SearXNG
      - "8081:8000"   # SurrealDB (internal 8000, exposed as 8081)
      - "8384:8384"   # Serena
      - "11434:11434" # Ollama
    volumes:
      # Persist data across container restarts
      - ollama-data:/data/ollama
      - surrealdb-data:/data/surrealdb
      - searxng-data:/data/searxng
      - serena-data:/data/serena
      # Optional: Mount your code for development
      - .:/workspace:cached
    environment:
      # Ollama configuration
      - OLLAMA_HOST=0.0.0.0
      - OLLAMA_MODELS=/data/ollama/models
      - OLLAMA_DEFAULT_MODELS=${OLLAMA_DEFAULT_MODELS:-llama2}

      # SurrealDB configuration
      - SURREALDB_USER=${SURREALDB_USER:-root}
      - SURREALDB_PASS=${SURREALDB_PASS:-root}
      - SURREALDB_NS=${SURREALDB_NS:-claudia}
      - SURREALDB_DB=${SURREALDB_DB:-main}

      # SearXNG configuration
      - SEARXNG_SECRET_KEY=${SEARXNG_SECRET_KEY:-changeme-generate-random-key}
      - SEARXNG_BASE_URL=${SEARXNG_BASE_URL:-http://localhost:8080}

      # Serena configuration
      - SERENA_API_KEY=${SERENA_API_KEY:-dev-key}

      # Playwright configuration
      - PLAYWRIGHT_HEADLESS=${PLAYWRIGHT_HEADLESS:-true}
      - PLAYWRIGHT_BROWSER=${PLAYWRIGHT_BROWSER:-chromium}

      # General
      - TZ=UTC
      - WORKSPACE=/workspace
    restart: unless-stopped
    healthcheck:
      test: ["/usr/local/bin/healthcheck.sh"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s
    networks:
      - claudia-network

volumes:
  ollama-data:
    driver: local
  surrealdb-data:
    driver: local
  searxng-data:
    driver: local
  serena-data:
    driver: local

networks:
  claudia-network:
    driver: bridge
    name: claudia-network
